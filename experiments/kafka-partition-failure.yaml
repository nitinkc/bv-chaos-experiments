apiVersion: chaos-mesh.org/v1alpha1
kind: NetworkChaos
metadata:
  name: kafka-partition-network
  namespace: bitvelocity
spec:
  action: partition
  mode: all
  selector:
    namespaces:
      - bitvelocity
    labelSelectors:
      app: kafka
  direction: both
  duration: '2m'
  target:
    selector:
      namespaces:
        - bitvelocity
      labelSelectors:
        app: order-service
    mode: all
---
# Experiment Details:
# - Creates network partition between Kafka and order-service
# - Duration: 2 minutes
# - Tests: Event publishing resilience, retry logic, DLQ handling
# 
# Expected Behavior:
# - Event publishing should fail initially
# - Kafka producer should retry with exponential backoff
# - Circuit breaker may open after threshold
# - Events should eventually be published (or DLQ)
# - Consumer lag should increase temporarily
# 
# Validation:
# - Check Kafka metrics: producer_send_failure, consumer_lag
# - Check application: event_publish_failures_total
# - Check Jaeger: Trace event publishing failures
# - Verify DLQ if configured
# 
# Learning Goals:
# - Understand Kafka producer retry behavior
# - Validate event-driven architecture resilience
# - Test consumer rebalancing
# 
# Recovery:
# - After experiment ends, verify consumer catches up
# - Check for duplicate events (idempotency)
